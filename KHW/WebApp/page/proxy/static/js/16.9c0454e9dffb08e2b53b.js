webpackJsonp([16],{kEye:function(e,n){},p7Cc:function(e,n,a){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),a("hRKE");var t=a("P9l9"),l=a("dia3"),i={data:function(){return{userperadmin:{},breadnav:{current:0,text:["新增渠道","修改渠道信息","分成历史记录"]},searchInfo:{loading:!1,channelNameList:[],channelNameSelected:"",channelList:[],channelSelected:"",channelLevelList:[{index:"",name:"全部渠道级别"},{index:1,name:"一级渠道"},{index:2,name:"二级渠道"}],channelLevelSelected:""},channelTableInfo:{loading:!1,tableData:[],pagination:{pageSizes:[10,20,50],pageSize:10,currentPage:1,dataSize:0}},editChannelInfo:{loading:!1,isEdit:!1,appList:[],appSelected:"",channelCount:0,firstLevelChannelNo:"",channelId:"",parameter:{level:"",channelName:"",channelNo:"",channel:"",appId:"",url:"",pwd:""},actionValidate:{channel:!1}},fcHistoryInfo:{loading:!1,channelName:"",tableData:[]}}},mounted:function(){this.userperadmin=JSON.parse(localStorage.getItem("userperadmin")),this.editChannelInfo.firstLevelChannelNo=this.userperadmin.proxy.channelNo,this.getSearchParamsFun(),this.getChannelListFun(1),this.getAppListFun()},methods:{indexFormatter1:function(e){return this.channelTableInfo.pagination.pageSize*(this.channelTableInfo.pagination.currentPage-1)+1+e},togglePositionFun:function(e){this.breadnav.current=e},getAppListFun:function(){var e=this,n={sessionid:this.userperadmin.sessionid};this.editChannelInfo.loading=!0,Object(t.L)(n).then(function(n){e.editChannelInfo.loading=!1,0===n.data.status?e.editChannelInfo.appList=n.data.appList:1===n.data.status?e.$router.replace("/login"):e.toast(n.data.statusMsg,"error")}).catch(function(n){e.editChannelInfo.loading=!1,e.toast("服务器错误，请联系管理员","error")})},getSearchParamsFun:function(){var e=this,n={sessionid:this.userperadmin.sessionid};this.searchInfo.loading=!0,Object(t._16)(n).then(function(n){e.searchInfo.loading=!1,0===n.data.status?(e.searchInfo.channelNameList=n.data.channelNameList,e.searchInfo.channelNoList=n.data.channelNoList):1===n.data.status?e.$router.replace("/login"):e.toast(n.data.statusMsg,"error")}).catch(function(n){e.searchInfo.loading=!1,e.toast("服务器错误，请联系管理员","error")})},getChannelListFun:function(e){var n,a=this;1===e?n={sessionid:this.userperadmin.sessionid,pageId:this.channelTableInfo.pagination.currentPage-1,pageSize:this.channelTableInfo.pagination.pageSize,first:0}:((n={sessionid:this.userperadmin.sessionid,pageId:this.channelTableInfo.pagination.currentPage-1,pageSize:this.channelTableInfo.pagination.pageSize}).first=2===e?0:1,void 0!==this.searchInfo.channelNameSelected&&""!==this.searchInfo.channelNameSelected&&(n.channelName=this.searchInfo.channelNameSelected.replace(/[-]/g,"")),void 0!==this.searchInfo.channelSelected&&""!==this.searchInfo.channelSelected&&(n.channel=this.searchInfo.channelSelected.replace(/[-]/g,"")),void 0!==this.searchInfo.channelLevelSelected&&""!==this.searchInfo.channelLevelSelected&&(n.level=this.searchInfo.channelLevelSelected)),this.channelTableInfo.loading=!0,Object(t.U)(n).then(function(e){if(a.channelTableInfo.loading=!1,0===e.data.status){a.channelTableInfo.tableData=e.data.channelList,e.data.listSize&&1!==n.first&&(a.channelTableInfo.pagination.dataSize=parseInt(e.data.listSize),a.editChannelInfo.channelCount=parseInt(e.data.listSize));var t=a;a.channelTableInfo.tableData.forEach(function(e,n,a){a[n].rewardPrice=t.rewardPriceFormatter(e.rewardPrice)})}else 1===e.data.status?a.$router.replace("/login"):a.toast(e.data.statusMsg,"error")}).catch(function(e){a.channelTableInfo.loading=!1,a.toast("服务器错误，请联系管理员","error")})},addChannelFun:function(){this.editChannelInfo.isEdit=!1,this.togglePositionFun(1),0!==this.editChannelInfo.channelCount?this.editChannelInfo.parameter.level="二级渠道":this.editChannelInfo.parameter.level="一级渠道"},checkChannelNoFun:function(){return""!==this.editChannelInfo.parameter.channelNo||this.editChannelInfo.isEdit?(this.editChannelInfo.actionValidate.channel=!1,!0):(this.editChannelInfo.actionValidate.channel=!0,this.toast("渠道编码不能为空","warning"),!1)},generateTopUrl:function(){0===this.editChannelInfo.channelCount&&(this.editChannelInfo.parameter.url=this.editChannelInfo.parameter.channelName+"总账号")},generateChannelFun:function(){var e=this;if(!this.editChannelInfo.isEdit&&this.checkChannelNoFun()){0===this.editChannelInfo.channelCount?(this.editChannelInfo.parameter.channel=this.editChannelInfo.parameter.channelNo,this.userperadmin.proxy.channelNo=this.editChannelInfo.parameter.channelNo,this.editChannelInfo.firstLevelChannelNo=this.editChannelInfo.parameter.channelNo):this.editChannelInfo.parameter.channel=this.editChannelInfo.firstLevelChannelNo+"_"+this.editChannelInfo.parameter.channelNo;var n={sessionid:this.userperadmin.sessionid,channel:this.editChannelInfo.parameter.channel};Object(t.o)(n).then(function(n){if(0===n.data.status){if(e.editChannelInfo.actionValidate.channel=!1,0===e.editChannelInfo.channelCount)e.editChannelInfo.parameter.url=e.editChannelInfo.parameter.channelName+"总账号";else if(""!==e.editChannelInfo.parameter.url){var a=e.editChannelInfo.parameter.url.indexOf("="),t=e.editChannelInfo.parameter.url.substring(0,a+1);""===e.editChannelInfo.parameter.channelNo?e.editChannelInfo.parameter.url=t:e.editChannelInfo.parameter.url=t+e.editChannelInfo.parameter.channel}}else 1===n.data.status?e.$router.replace("/login"):(e.editChannelInfo.actionValidate.channel=!0,e.toast(n.data.statusMsg,"error"))}).catch(function(n){e.editChannelInfo.actionValidate.channel=!1,e.toast("服务器错误，请联系管理员","error")})}},resetChannelInfoInputFun:function(){this.editChannelInfo.parameter.level="",this.editChannelInfo.parameter.channelName="",this.editChannelInfo.parameter.channelNo="",this.editChannelInfo.parameter.channel="",this.editChannelInfo.parameter.appId="",this.editChannelInfo.appSelected="",this.editChannelInfo.parameter.url="",this.editChannelInfo.parameter.pwd=""},saveChannelFun:function(){var e=this;if(""!==this.editChannelInfo.parameter.channelName)if(this.editChannelInfo.actionValidate.channel)this.toast("渠道号不能为空","warning");else if(""!==this.editChannelInfo.parameter.appId)if(""===this.editChannelInfo.parameter.pwd||this.editChannelInfo.parameter.length<6)this.toast("渠道登录密码不能为空且不能少于6位","warning");else{var n={sessionid:this.userperadmin.sessionid,proxyId:this.userperadmin.proxy.id,level:"二级渠道"===this.editChannelInfo.parameter.level?2:1,channelName:this.editChannelInfo.parameter.channelName,channelNo:this.editChannelInfo.parameter.channelNo,channel:this.editChannelInfo.parameter.channel,url:this.editChannelInfo.parameter.url,appId:this.editChannelInfo.parameter.appId,pwd:this.editChannelInfo.parameter.pwd};this.editChannelInfo.isEdit&&(n.id=this.editChannelInfo.channelId),this.editChannelInfo.loading=!0,Object(t._24)(n).then(function(n){e.editChannelInfo.loading=!1,0===n.data.status?(e.togglePositionFun(0),e.resetChannelInfoInputFun(),e.getChannelListFun(1),e.getSearchParamsFun()):1===n.data.status?e.$router.replace("/login"):e.toast(n.data.statusMsg,"error")}).catch(function(n){e.editChannelInfo.loading=!1,e.toast("服务器错误，请联系管理员","error")})}else this.toast("所属APP不能为空","warning");else this.toast("渠道名称不能为空","warning")},cacelSaveFun:function(){this.togglePositionFun(0),this.resetChannelInfoInputFun()},editChannelInfoFun:function(e,n){this.togglePositionFun(2),this.editChannelInfo.isEdit=!0,this.editChannelInfo.channelId=e.id,this.editChannelInfo.parameter.level=1===e.level?"一级渠道":"二级渠道",this.editChannelInfo.parameter.channelName=e.channelName,this.editChannelInfo.parameter.channelNo=e.channelNo,this.editChannelInfo.parameter.channel=e.channel,this.editChannelInfo.parameter.url=e.url,this.editChannelInfo.parameter.appId=e.appId,this.editChannelInfo.parameter.pwd=e.pwd;var a=this;this.editChannelInfo.appList.forEach(function(n,t){e.appId===n.id&&(a.editChannelInfo.appSelected=t)})},getChannelFcHistoryFun:function(e,n){var a=this;this.togglePositionFun(3),this.fcHistoryInfo.channelName=e.channelName;var l={sessionid:this.userperadmin.sessionid,channelId:e.id};this.fcHistoryInfo.tableData=[],this.fcHistoryInfo.loading=!0,Object(t.Z)(l).then(function(e){if(a.fcHistoryInfo.loading=!1,0===e.data.status){a.fcHistoryInfo.tableData=e.data.rewardList;var n=a;a.fcHistoryInfo.tableData.forEach(function(e,a,t){t[a].rewardPrice=n.rewardPriceFormatter(e.rewardPrice,1)})}else 1===e.data.status?a.$router.replace("/login"):a.toast(e.data.statusMsg,"error")}).catch(function(e){a.fcHistoryInfo.loading=!1,a.toast("服务器错误，请联系管理员1","error")})},channelTablePageSizeChange:function(e){this.channelTableInfo.pagination.pageSize=e,this.channelTableInfo.pagination.currentPage=1,this.getChannelListFun(3)},channelTableCurrentPageChange:function(e){this.channelTableInfo.pagination.currentPage=e,this.getChannelListFun(3)},selectChange:function(e){1===e?this.searchInfo.channelNameSelected=this.searchInfo.channelNameSelected.replace(/[-]/g,""):this.searchInfo.channelSelected=this.searchInfo.channelSelected.replace(/[-]/g,"")},appChange:function(e){this.editChannelInfo.parameter.appId=this.editChannelInfo.appList[e].id,this.editChannelInfo.parameter.url=this.editChannelInfo.appList[e].other+this.editChannelInfo.parameter.channel},rewardTypeIdFormatter:function(e,n,a){return 26===a?"CPA单价":27===a?"CPS首提":28===a?"CPS比例":29===a?"CPS开户":a},rewardPriceFormatter:function(e,n){if(e){var a=e.split(","),t=[],l=[];if(a.length<=1)if(1===n){var i=e.split("/");t.push(i[1])}else t.push(a[0]);else this.editFcTypeData=a,a.forEach(function(e,n){var a=e.split("/");l.push({max:a[0],price:a[1]}),t[n]=0===n?"0 - "+a[0]+" : "+a[1]:parseInt(l[n-1].max)+1+" - "+a[0]+" : "+a[1]});return t}},dateFormatter:function(e,n,a){return Object(l.g)(e.date)},toast:function(e,n){this.$message({type:n,message:e})}}},r={render:function(){var e=this,n=e.$createElement,a=e._self._c||n;return a("div",{staticClass:"page channels-page"},[a("h3",{staticClass:"breadnav"},[e._v("当前位置："),a("span",{class:{link:0!==e.breadnav.current},on:{click:function(n){e.togglePositionFun(0)}}},[e._v("渠道管理")]),0!==e.breadnav.current?a("span",[e._v(" > "+e._s(e.breadnav.text[e.breadnav.current-1]))]):e._e()]),e._v(" "),a("section",{directives:[{name:"show",rawName:"v-show",value:0===e.breadnav.current,expression:"breadnav.current === 0"},{name:"loading",rawName:"v-loading",value:e.searchInfo.loading,expression:"searchInfo.loading"}],staticClass:"action-container",attrs:{"element-loading-spinner":"el-icon-loading","element-loading-text":"拼命加载中"}},[a("div",{staticClass:"flex-item search-form"},[a("el-select",{attrs:{clearable:"",filterable:"","allow-create":"","default-first-option":"",placeholder:"选择渠道名称"},model:{value:e.searchInfo.channelNameSelected,callback:function(n){e.$set(e.searchInfo,"channelNameSelected",n)},expression:"searchInfo.channelNameSelected"}},e._l(e.searchInfo.channelNameList,function(e){return a("el-option",{key:e,attrs:{label:e,value:e}})})),e._v(" "),a("el-select",{attrs:{clearable:"",filterable:"","allow-create":"","default-first-option":"",placeholder:"选择渠道号"},model:{value:e.searchInfo.channelSelected,callback:function(n){e.$set(e.searchInfo,"channelSelected",n)},expression:"searchInfo.channelSelected"}},e._l(e.searchInfo.channelNoList,function(e){return a("el-option",{key:e,attrs:{label:e,value:e}})})),e._v(" "),a("el-select",{attrs:{clearable:"",filterable:"","allow-create":"","default-first-option":"",placeholder:"选择渠道级别"},model:{value:e.searchInfo.channelLevelSelected,callback:function(n){e.$set(e.searchInfo,"channelLevelSelected",n)},expression:"searchInfo.channelLevelSelected"}},e._l(e.searchInfo.channelLevelList,function(e){return a("el-option",{key:e.index,attrs:{label:e.name,value:e.index}})})),e._v(" "),a("button",{on:{click:function(n){e.getChannelListFun(2)}}},[a("i",{staticClass:"fa fa-search"}),e._v("搜索")])],1)]),e._v(" "),a("section",{directives:[{name:"show",rawName:"v-show",value:0===e.breadnav.current,expression:"breadnav.current === 0"},{name:"loading",rawName:"v-loading",value:e.channelTableInfo.loading,expression:"channelTableInfo.loading"}],staticClass:"table-container",attrs:{"element-loading-spinner":"el-icon-loading","element-loading-text":"拼命加载中"}},[a("el-table",{staticStyle:{width:"100%"},attrs:{data:e.channelTableInfo.tableData,border:"",size:"small"}},[a("el-table-column",{attrs:{type:"index",label:"序号",index:e.indexFormatter1}}),e._v(" "),a("el-table-column",{attrs:{prop:"channelName",label:"渠道名称"}}),e._v(" "),a("el-table-column",{attrs:{prop:"channelNo",label:"渠道编码"}}),e._v(" "),a("el-table-column",{attrs:{prop:"channel",label:"渠道号"}}),e._v(" "),a("el-table-column",{attrs:{prop:"level",label:"渠道级别"}}),e._v(" "),a("el-table-column",{attrs:{prop:"rewardTypeId",label:"分成方式",formatter:e.rewardTypeIdFormatter}}),e._v(" "),a("el-table-column",{attrs:{prop:"rewardPrice",label:"分成比例"},scopedSlots:e._u([{key:"default",fn:function(n){return e._l(n.row.rewardPrice,function(n){return a("p",{attrs:{"close-transition":""}},[e._v(e._s(n))])})}}])}),e._v(" "),a("el-table-column",{attrs:{label:"操作"},scopedSlots:e._u([{key:"default",fn:function(n){return[a("el-button",{attrs:{type:"text",size:"small"},on:{click:function(a){e.editChannelInfoFun(n.row,n.$index)}}},[a("i",{staticClass:"fa fa-pencil-square-o",attrs:{"aria-hidden":"true"}}),e._v("修改")]),e._v(" "),a("el-button",{attrs:{type:"text",size:"small"},on:{click:function(a){e.getChannelFcHistoryFun(n.row,n.$index)}}},[a("i",{staticClass:"fa fa-list-alt",attrs:{"aria-hidden":"true"}}),e._v("历史")])]}}])})],1),e._v(" "),a("el-pagination",{staticClass:"paginationWrapper",attrs:{background:"","current-page":e.channelTableInfo.pagination.currentPage,"page-sizes":e.channelTableInfo.pagination.pageSizes,"page-size":e.channelTableInfo.pagination.pageSize,layout:"total, sizes, prev, pager, next, jumper",total:e.channelTableInfo.pagination.dataSize},on:{"size-change":e.channelTablePageSizeChange,"current-change":e.channelTableCurrentPageChange}})],1),e._v(" "),1===e.breadnav.current||2===e.breadnav.current?a("section",{directives:[{name:"loading",rawName:"v-loading",value:e.editChannelInfo.loading,expression:"editChannelInfo.loading"}],staticClass:"form-wrapper",attrs:{"element-loading-spinner":"el-icon-loading","element-loading-text":"拼命加载中"}},[a("h4",{staticClass:"title"},[e._v(e._s(e.breadnav.text[e.breadnav.current-1]))]),e._v(" "),a("div",{staticClass:"input-group required"},[a("label",{attrs:{for:"level"}},[e._v("渠道级别")]),e._v(" "),a("input",{directives:[{name:"model",rawName:"v-model",value:e.editChannelInfo.parameter.level,expression:"editChannelInfo.parameter.level"}],attrs:{type:"text",readonly:"true",id:"level"},domProps:{value:e.editChannelInfo.parameter.level},on:{input:function(n){n.target.composing||e.$set(e.editChannelInfo.parameter,"level",n.target.value)}}})]),e._v(" "),a("div",{staticClass:"input-group required"},[a("label",{attrs:{for:"channelName"}},[e._v("渠道名称")]),e._v(" "),a("input",{directives:[{name:"model",rawName:"v-model",value:e.editChannelInfo.parameter.channelName,expression:"editChannelInfo.parameter.channelName"}],attrs:{type:"text",id:"channelName",readonly:"true"},domProps:{value:e.editChannelInfo.parameter.channelName},on:{blur:e.generateTopUrl,input:function(n){n.target.composing||e.$set(e.editChannelInfo.parameter,"channelName",n.target.value)}}})]),e._v(" "),a("div",{staticClass:"input-group required"},[a("label",{attrs:{for:"channelNo"}},[e._v("渠道编码")]),e._v(" "),a("input",{directives:[{name:"model",rawName:"v-model",value:e.editChannelInfo.parameter.channelNo,expression:"editChannelInfo.parameter.channelNo"}],class:{error:e.editChannelInfo.actionValidate.channel},attrs:{type:"text",id:"channelNo",readonly:e.editChannelInfo.isEdit,oninput:"value=value.replace(/[^0-9a-zA-Z]/g,'')"},domProps:{value:e.editChannelInfo.parameter.channelNo},on:{blur:e.generateChannelFun,input:function(n){n.target.composing||e.$set(e.editChannelInfo.parameter,"channelNo",n.target.value)}}})]),e._v(" "),a("div",{staticClass:"input-group required"},[a("label",{attrs:{for:"channel"}},[e._v("渠道号")]),e._v(" "),a("input",{directives:[{name:"model",rawName:"v-model",value:e.editChannelInfo.parameter.channel,expression:"editChannelInfo.parameter.channel"}],attrs:{type:"text",id:"channel",readonly:"true"},domProps:{value:e.editChannelInfo.parameter.channel},on:{input:function(n){n.target.composing||e.$set(e.editChannelInfo.parameter,"channel",n.target.value)}}})]),e._v(" "),a("div",{staticClass:"input-group required"},[a("label",[e._v("所属APP")]),e._v(" "),a("el-select",{attrs:{disabled:e.editChannelInfo.isEdit,filterable:"","allow-create":"","default-first-option":"",placeholder:"选择APP"},on:{change:e.appChange},model:{value:e.editChannelInfo.appSelected,callback:function(n){e.$set(e.editChannelInfo,"appSelected",n)},expression:"editChannelInfo.appSelected"}},e._l(e.editChannelInfo.appList,function(e,n){return a("el-option",{key:n,attrs:{label:e.name,value:n}})}))],1),e._v(" "),a("div",{staticClass:"input-group textAreaInput required"},[a("label",{attrs:{for:"url"}},[e._v("推广链接")]),e._v(" "),a("textarea",{directives:[{name:"model",rawName:"v-model",value:e.editChannelInfo.parameter.url,expression:"editChannelInfo.parameter.url"}],attrs:{id:"url",readonly:"true"},domProps:{value:e.editChannelInfo.parameter.url},on:{input:function(n){n.target.composing||e.$set(e.editChannelInfo.parameter,"url",n.target.value)}}})]),e._v(" "),a("div",{staticClass:"input-group required"},[a("label",{attrs:{for:"pwd"}},[e._v("渠道登陆密码")]),e._v(" "),a("input",{directives:[{name:"model",rawName:"v-model",value:e.editChannelInfo.parameter.pwd,expression:"editChannelInfo.parameter.pwd"}],attrs:{type:"text",maxLength:"12",id:"pwd",oninput:"value=value.replace(/[^0-9a-zA-Z]/g,'')",placeholder:"6-12位数字或字母组合"},domProps:{value:e.editChannelInfo.parameter.pwd},on:{input:function(n){n.target.composing||e.$set(e.editChannelInfo.parameter,"pwd",n.target.value)}}})]),e._v(" "),a("div",{staticClass:"btns"},[a("button",{staticClass:"primary",on:{click:e.saveChannelFun}},[e._v("确 定")]),e._v(" "),a("button",{staticClass:"info",on:{click:e.cacelSaveFun}},[e._v("取 消")])])]):e._e(),e._v(" "),3===e.breadnav.current?a("section",{staticClass:"form-wrapper"},[a("h4",{staticClass:"title"},[e._v("分成历史记录")]),e._v(" "),a("p",{staticClass:"table-title"},[e._v("当前渠道："),a("span",[e._v(e._s(e.fcHistoryInfo.channelName))]),a("span",{staticClass:"back",on:{click:function(n){e.togglePositionFun(0)}}},[e._v("返回")])]),e._v(" "),a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.fcHistoryInfo.loading,expression:"fcHistoryInfo.loading"}],staticStyle:{width:"100%"},attrs:{data:e.fcHistoryInfo.tableData,height:"400",border:"","element-loading-spinner":"el-icon-loading","element-loading-text":"拼命加载中"}},[a("el-table-column",{attrs:{type:"index",label:"序号",width:"60"}}),e._v(" "),a("el-table-column",{attrs:{property:"typeId",label:"分成方式",formatter:e.rewardTypeIdFormatter}}),e._v(" "),a("el-table-column",{attrs:{prop:"rewardPrice",label:"分成比例 | 单价"},scopedSlots:e._u([{key:"default",fn:function(n){return e._l(n.row.rewardPrice,function(n){return a("p",{attrs:{"close-transition":""}},[e._v(e._s(n))])})}}])}),e._v(" "),a("el-table-column",{attrs:{property:"date",label:"分成起始时间",sortable:"",formatter:e.dateFormatter}})],1)],1):e._e()])},staticRenderFns:[]},o=a("vSla")(i,r,!1,function(e){a("kEye")},"data-v-167db1b3",null);n.default=o.exports}});